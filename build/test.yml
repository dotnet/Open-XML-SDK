parameters:
  framework: ''

steps:
  - checkout: none

  - download: current
    artifact: build
    patterns: '*.Tests/${{ parameters.framework }}/publish/**/*'

  - powershell: |
      gci -r
    workingDirectory: '$(Pipeline.Workspace)'

  - task: VSTest@2
    inputs:
      testAssemblyVer2: |
        **\publish\*Tests.dll
      runInParallel: true
      platform: '$(BuildPlatform)'
      configuration: '$(BuildConfiguration)'
      ${{ if contains(parameters.framework, 'core')}}:
        otherConsoleOptions: '/Framework:FrameworkCore10 /platform:x64'
      diagnosticsEnabled: True
      searchFolder: '$(Pipeline.Workspace)\build'
