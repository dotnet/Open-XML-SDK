steps:
  - checkout: none

  - download: current
    artifact: unsigned

  - task: SFP.build-tasks.custom-build-task-1.EsrpCodeSigning@1
    displayName: 'OpenXML SDK Nuget Pkg ESRP CodeSigning'
    inputs:
      ConnectedServiceName: 'Open-XML-SDK-ESRP-2021b'
      FolderPath: '$(Build.ArtifactStagingDirectory)'
      Pattern: '*.nupkg'
      signConfigType: inlineSignParams
      inlineOperation: |
        [
            {
                "keyCode": "CP-401405",
                "operationSetCode": "NuGetSign",
                "parameters": [ ],
                "toolName": "sign",
                "toolVersion": "1.0"
            },
            {
                "keyCode": "CP-401405",
                "operationSetCode": "NuGetVerify",
                "parameters": [ ],
                "toolName": "sign",
                "toolVersion": "1.0"
            }
        ]

  - task: CopyFiles@2
    inputs:
      sourceFolder: '$(Pipeline.Workspace)/unsigned'
      contents: '*.snupkg'
      targetFolder: '$(Build.ArtifactStagingDirectory)'

  - task: PublishBuildArtifacts@1
    displayName: 'Publish Signed'
    inputs:
      PathtoPublish: '$(Build.ArtifactStagingDirectory)'
      artifactName: 'signed'
